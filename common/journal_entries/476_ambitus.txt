je_crisis_of_illegitimacy = {
	icon = "gfx/interface/icons/ideology_icons/unused/jingoist_leader.dds"

	group = je_group_historical_content
	
	#scripted_button = caudillo_decree_button

	immediate = {
		save_scope_as = caudillo_country_scope

		#ordered_scope_politician = {
		#	limit = {
		#		is_ruler = no
		#		is_heir = no
		#		interest_group = {
		#			OR = {
		#				is_powerful = yes
		#				is_in_government = yes
		#			}
		#		}
		#	}
		#	order_by = popularity
		#	save_scope_as = ambitus_ig_leader
		#}
		ordered_interest_group = {
			limit = {
				is_powerful = yes
				leader = {
					is_ruler = no
					is_heir = no
				}
				#leader.popularity > ruler.popularity
			}
			order_by = ig_clout
			save_scope_as = ambitus_ig
			leader = {
				save_scope_as = ambitus_ig_leader
			}
		}
	}

	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = crisis_of_illegitimacy_no_candidate
				trigger = {
					NOT = { exists = scope:ambitus_ig_leader }
				}
			}
#			triggered_desc = {
#				desc = crisis_of_illegitimacy_top_candidate_more_powerful_than_emp
#				trigger = {
#					exists = scope:ambitus_ig_leader
#					OR = {
#						AND = {
#							scope:ambitus_ig = {
#								any_scope_character = { is_ruler = yes }
#							}
#							scope:ambitus_ig_leader.popularity > ruler.popularity
#						}
#						AND = {
#							scope:ambitus_ig = {
#								NOT = {
#									any_scope_character = { is_ruler = yes }
#								}
#							}
#							scope:ambitus_ig.ig_clout > ruler.interest_group.ig_clout
#						}
#					}
#				}
#			}
			triggered_desc = {
				desc = crisis_of_illegitimacy_top_candidate_less_powerful_than_emp
				trigger = {
					exists = scope:ambitus_ig_leader
				}
			}
		}
	}

	complete = {
		NOT = {
			any_interest_group = {
				is_powerful = yes
				leader = {
					is_ruler = no
					has_role = general
					OR = {
						has_trait = ambitious
						has_trait = reckless
					}
				}
				leader.popularity > owner.ruler.popularity
			}
		}
		custom_tooltip = {
			text = caudillo_complete
			root.var:caudillo_var <= 0
		}
	}

	on_complete = {
		trigger_event = { id = fall_of_rome_events.2 popup = yes }
		show_as_tooltip = {
			ig:ig_armed_forces = {
				remove_ideology = ideology_caudillismo
			}
			remove_modifier = age_of_caudillos_modifier
		}
	}

	fail = {
		ig:ig_armed_forces = {
			is_in_government = yes
		}
		custom_tooltip = {
			text = je_caudillo_goal_tt
			scope:journal_entry = {
				is_goal_complete = yes
			}
		}
	}

	on_fail = {
		trigger_event = { id = fall_of_rome_events.3 popup = yes } # No More Games
		custom_tooltip = crisis_of_illegitimacy_rome_dies
	}

	on_weekly_pulse = {
		effect = {
            calculate_ambitus_progress = yes
        }
	}

	on_monthly_pulse = {
		effect = {
			change_variable = { name = caudillo_var add = var:caudillo_next }
			if = {
				limit = {
					NOT = { exists = scope:ambitus_ig_leader }
				}
				ordered_interest_group = {
					limit = {
						is_powerful = yes
						leader = {
							is_ruler = no
						}
						leader.popularity > owner.ruler.popularity
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = scope:ambitus_ig_leader }
				}
				ordered_interest_group = {
					limit = {
						is_powerful = yes
						leader = {
							is_ruler = no
						}
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = scope:ambitus_ig_leader }
				}
				ordered_interest_group = {
					limit = {
						leader.popularity > owner.ruler.popularity
						leader = {
							is_ruler = no
						}
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}
			else_if = {
				limit = {
					NOT = { exists = scope:ambitus_ig_leader }
				}
				ordered_interest_group = {
					limit = {
						leader = {
							is_ruler = no
						}
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}

			### set new Most Amitious Character if current one isn't valid
			else_if = {
				limit = {
					exists = scope:ambitus_ig_leader
					scope:ambitus_ig_leader = {
						OR = {
							is_ruler = yes
							is_heir = yes
							NOT = { has_role = politician }
							is_in_exile_pool = yes
							is_character_alive = no
						}
					}
				}
				clear_saved_scope = ambitus_ig
				clear_saved_scope = ambitus_ig_leader
				ordered_interest_group = {
					limit = {
						is_powerful = yes
						leader = {
							is_ruler = no
						}
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}
			else_if = {
				limit = {
					exists = scope:ambitus_ig_leader
					scope:ambitus_ig_leader = {
						OR = {
							is_ruler = yes
							is_heir = yes
							NOT = { has_role = politician }
							is_in_exile_pool = yes
							is_character_alive = no
						}
					}
				}
				clear_saved_scope = ambitus_ig
				clear_saved_scope = ambitus_ig_leader
				ordered_interest_group = {
					limit = {
						leader.popularity > owner.ruler.popularity
						leader = {
							is_ruler = no
						}
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}
			else_if = {
				limit = {
					exists = scope:ambitus_ig_leader
					scope:ambitus_ig_leader = {
						OR = {
							is_ruler = yes
							is_heir = yes
							NOT = { has_role = politician }
							is_in_exile_pool = yes
							is_character_alive = no
						}
					}
				}
				clear_saved_scope = ambitus_ig
				clear_saved_scope = ambitus_ig_leader
				ordered_interest_group = {
					limit = {
						leader = {
							is_ruler = no
						}
					}
					order_by = ig_clout
					save_scope_as = ambitus_ig
					leader = {
						save_scope_as = ambitus_ig_leader
					}
				}
			}
		}

		#random_events = {
		#	# Pulse events affect the progress bar
		#	120 = 0 
		#}
	}

	on_yearly_pulse = {
		random_events = {
			70 = 0
			30 = fall_of_rome_events.4 # Conflict of the Urban Orders
			30 = fall_of_rome_events.7 # Language Reform?
			30 = fall_of_rome_events.9 # Bagaudae Disturb State
		}
	}

	current_value = {
		value = root.var:caudillo_var
	}

	goal_add_value = {
		add = 1200
	}

	progressbar = yes

	weight = 100

	can_revolution_inherit = yes
	transferable = yes
	should_be_pinned_by_default = yes
}
