namespace = roman_illegitimacy

# Crisis of Illegitimacy startup event
roman_illegitimacy.1 = {
	type = country_event
	placement = ROOT
	
	title = roman_illegitimacy.1.t
	desc = roman_illegitimacy.1.d
	flavor = roman_illegitimacy.1.f
	
	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"
	
	duration = 3
	
	trigger = {
		# triggered by generic monthly pulse

		# can trigger for any Roman(tic) Empire. None of you are free of this curse.
		country_tier = empire

		any_primary_culture = {
			# essentially the same as scripted trigger greco_roman_european_culture
			has_discrimination_trait = european_heritage
			OR = {
				has_discrimination_trait = romance_speaker
				has_discrimination_trait = greek_culture
			}
		}

		#
		NOT = { has_variable = caudillo_var }
		legitimacy < 75
		any_interest_group = {
			is_powerful = yes
			leader = {
				is_ruler = no
				has_role = general
				OR = {
					has_trait = ambitious
					has_trait = reckless
				}
			}
			leader.popularity > ruler.popularity
		}
	}

	immediate = {
		set_variable = {
			name = caudillo_var
			value = 0
		}
		set_variable = { 
			name = caudillo_next 
			value = 0 
		}
		set_scope_as = rome_on_the_edge
		capital = {
			save_scope_as = capital_scope
		}
		set_global_variable = { # ensures military presidents aren't replaced super early
			name = continuismo_start_var
			months = long_modifier_time
		}

		#ig:ig_armed_forces = {
		#	save_scope_as = army_scope
		#}
		#random_scope_character = {
		#	limit = {
		#		has_role = general
		#	}
		#	save_scope_as = general_scope
		#}
		ordered_interest_group = {
			limit = {
				is_powerful = yes
				leader = {
					is_ruler = no
					OR = {
						has_trait = ambitious
						has_trait = reckless
					}
				}
				leader.popularity > ruler.popularity
			}
			order_by = ig_clout
			save_scope_as = ambitus_ig
			leader = {
				save_scope_as = ambitus_ig_leader
				set_variable = ambitus_ig_leader_tracked
			}
		}
	}
	option = { 
		name = roman_illegitimacy.1.a
		default_option = yes
		add_journal_entry = { type = je_crisis_of_illegitimacy }
		if = { 
			limit = {	# democratic states will have an easier start
				country_has_voting_franchise = yes
			}
			custom_tooltip = roman_illegitimacy_democratic_institutions_good
			change_variable = {
				name = caudillo_var
				add = 400
			}
		}
		else = {
			change_variable = {
				name = caudillo_var
				add = 600
			}
		}
	}
}

# Return of Legitimacy
roman_illegitimacy.2 = {
	type = country_event
	placement = ROOT
	
	title = roman_illegitimacy.2.t
	desc = roman_illegitimacy.2.d
	flavor = roman_illegitimacy.2.f
	
	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"
	
	duration = 3
	
	trigger = {
		# triggered by je_caudillo
	}

	immediate = {
		ordered_interest_group = {
			limit = {
				is_powerful = yes
			}
			order_by = ig_clout
			save_scope_as = most_powerful_ig
			leader = {
				save_scope_as = most_powerful_ig_leader
			}
		}
	}
	option = { 
		name = roman_illegitimacy.2.a
		default_option = yes

		remove_modifier = age_of_caudillos_modifier
	}
}

# No More Games - based off caudillo.3, the Fist Clenches
roman_illegitimacy.3 = {
	type = country_event
	placement = ROOT
	
	title = roman_illegitimacy.3.t
	desc = roman_illegitimacy.3.d
	flavor = roman_illegitimacy.3.f
	
	event_image = {
		texture = "fall_of_rome"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"
	
	duration = 3
	
	trigger = {
		# triggered by je_crisis_of_illegitimacy
	}

	immediate = {
		capital = {
			save_scope_as = capital_scope
		}
		ruler = {
			save_scope_as = main_character_scope
		}
		ordered_interest_group = {
			limit = {
				is_powerful = yes
				leader = {
					is_ruler = no
					OR = {
						has_trait = ambitious
						has_trait = reckless
					}
				}
				leader.popularity > ruler.popularity
			}
			order_by = ig_clout
			save_scope_as = ambitus_ig
			leader = {
				save_scope_as = ambitus_ig_leader
			}
		}
	}
	option = { 
		name = roman_illegitimacy.3.a
		default_option = yes
		hidden_effect = {
			remove_modifier = age_of_caudillos_modifier
		}


		every_subject_or_below = {
			limit = {
				NOT = { any_overlord_or_above = { NOT = { ROOT = this } } }
				NOT = { is_subject_type = subject_type_personal_union }
			}
			make_independent = yes
		}

		# empire becomes a kingdom. couple of specific tag changes, then going for dynamics
		if = {
			limit = {
				capital = {
					region = sr:region_italy
				}
				NOT = { exists = c:ITA }
			}
			change_tag = c:ITA
		}
		else_if = {
			limit = {
				capital = {
					region = sr:region_balkans
				}
				NOT = { exists = c:ILY }
			}
			change_tag = c:ILY
		}
		else_if = {
			limit = {
				capital = {
					region = sr:region_north_africa
				}
				NOT = { exists = c:AFR }
			}
			change_tag = c:AFR
		}
		else_if = {
			limit = {
				capital = {
					region = sr:region_occitania
				}
				NOT = { exists = c:SPT }
			}
			change_tag = c:SPT
		}
		else_if = {
			limit = {
				capital = {
					state_region = s:STATE_PICARDY
				}
				NOT = { exists = c:SOI }
			}
			change_tag = c:SOI
		}
		else_if = {
			limit = {
				capital = {
					region = sr:region_thracia
				}
				NOT = { exists = c:GRE }
			}
			change_tag = c:GRE
		}
		# dynamics
		else_if = {
			limit = {
				NOT = { exists = c:RE1 }
			}
			change_tag = c:RE1
		}
		else_if = {
			limit = {
				NOT = { exists = c:RE2 }
			}
			change_tag = c:RE2
		}
		else_if = {
			limit = {
				NOT = { exists = c:RE3 }
			}
			change_tag = c:RE3
		}
		else_if = {
			limit = {
				NOT = { exists = c:RE4 }
			}
			change_tag = c:RE4
		}

		hidden_effect = {
			scope:main_character_scope = {
				kill_character = yes
			}
		}
		scope:ambitus_ig_leader = {
			set_character_as_ruler = yes
		}

		### Implosion outside the Imperial Core for whatever's left
		hidden_effect = {

			# Italy implodes if capital not in Italy #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_italy }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:SIC }
						any_scope_state = { state_region = s:STATE_SICILY }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_SICILY } 
						save_temporary_scope_as = sicilian_state
					}
					create_country = {
						tag = SIC
						origin = this
						state = scope:sicilian_state
						on_created = {
							warlord_setup_effect = yes
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:MDL }
						any_scope_state = { state_region = s:STATE_LOMBARDY }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_LOMBARDY } 
						save_temporary_scope_as = lombardy_state
					}
					create_country = {
						tag = MDL
						origin = this
						state = scope:lombardy_state
						on_created = {
							warlord_setup_effect = yes
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:ITA }
						any_scope_state = { region = sr:region_italy }
					}
					random_scope_state = { 
						limit = { region = sr:region_italy } 
						save_temporary_scope_as = italian_state
					}
					create_country = {
						tag = ITA
						origin = this
						state = scope:italian_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_italy
									}
									set_state_owner = c:ITA
								}
							}
						}
					}
				}
			}
			# Illyricum implodes if capital not in Balkans #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_balkans }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:ALB }
						any_scope_state = { state_region = s:STATE_ALBANIA }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_ALBANIA } 
						save_temporary_scope_as = albania_state
					}
					create_country = {
						tag = ALB
						origin = this
						state = scope:albania_state
						on_created = {
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:ILY }
						any_scope_state = { region = sr:region_balkans }
					}
					random_scope_state = { 
						limit = { region = sr:region_balkans } 
						save_temporary_scope_as = balkan_state
					}
					create_country = {
						tag = ITA
						origin = this
						state = scope:balkan_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_balkans
									}
									set_state_owner = c:ILY
								}
							}
						}
					}
				}
			}
			# Gaul implodes if capital not in Gallia #
			if = {
				limit = {
					capital = {
						NOR = { 
							region = sr:region_france
							region = sr:region_occitania
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:GTH }
						any_scope_state = { state_region = s:STATE_LANGUEDOC }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_LANGUEDOC } 
						save_temporary_scope_as = languedoc_state
					}
					create_country = {
						tag = GTH
						origin = this
						state = scope:languedoc_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = { state_region = { is_homeland = cu:gothic } }
								}
								set_state_owner = c:GTH
							}
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:BGN }
						any_scope_state = { state_region = s:STATE_WEST_SWITZERLAND }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_WEST_SWITZERLAND } 
						save_temporary_scope_as = west_switzerland_state
					}
					create_country = {
						tag = BGN
						origin = this
						state = scope:west_switzerland_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = { state_region = { is_homeland = cu:burgundian } }
								}
								set_state_owner = c:BGN
							}
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:BRI }
						any_scope_state = { state_region = s:STATE_BRITTANY }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_BRITTANY } 
						save_temporary_scope_as = britanny_state
					}
					create_country = {
						tag = BRI
						origin = this
						state = scope:britanny_state
						on_created = {
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:SOI }
						any_scope_state = { state_region = s:STATE_PICARDY }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_PICARDY } 
						save_temporary_scope_as = soissons_state
					}
					create_country = {
						tag = SOI
						origin = this
						state = scope:soissons_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										OR = {
											region = sr:region_france
											region = sr:region_rhine
										}
									}
									set_state_owner = c:SOI
								}
							}
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:SPT }
						any_scope_state = { region = sr:region_occitania }
					}
					random_scope_state = { 
						limit = { region = sr:region_occitania } 
						save_temporary_scope_as = septimania_state
					}
					create_country = {
						tag = SPT
						origin = this
						state = scope:septimania_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_occitania
									}
									set_state_owner = c:SPT
								}
							}
						}
					}
				}
				if = {
					limit = { 
						OR = { 
							NOT = { exists = c:RE1 }
							NOT = { exists = c:RE2 }
							NOT = { exists = c:RE3 }
							NOT = { exists = c:RE4 }
						}
						any_scope_state = { 
							OR = {
								region = sr:region_france
								region = sr:region_occitania
								region = sr:region_rhine
							}
							is_capital = no
						}
					}
					random_scope_state = { 
						limit = { 
							OR = {
								region = sr:region_france
								region = sr:region_occitania
								region = sr:region_rhine
							}
							is_capital = no
						} 
						save_temporary_scope_as = gallic_state
					}
					if = {
						limit = { NOT = { exists = c:RE1 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:gallic_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											OR = {
												region = sr:region_france
												region = sr:region_occitania
												region = sr:region_rhine
											}
											is_capital = no
										}
										set_state_owner = c:RE1
									}
								}
							}
						}
					}
					else_if = {
						limit = { NOT = { exists = c:RE2 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:gallic_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											OR = {
												region = sr:region_france
												region = sr:region_occitania
												region = sr:region_rhine
											}
											is_capital = no
										}
										set_state_owner = c:RE2
									}
								}
							}
						}
					}
					else_if = {
						limit = { NOT = { exists = c:RE3 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:gallic_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											OR = {
												region = sr:region_france
												region = sr:region_occitania
												region = sr:region_rhine
											}
											is_capital = no
										}
										set_state_owner = c:RE3
									}
								}
							}
						}
					}
					else_if = {
						limit = { NOT = { exists = c:RE4 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:gallic_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											OR = {
												region = sr:region_france
												region = sr:region_occitania
												region = sr:region_rhine
											}
											is_capital = no
										}
										set_state_owner = c:RE4
									}
								}
							}
						}
					}
				}
			}
			# Hispania implodes if capital not in Hispania #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_iberia }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:LST }
						any_scope_state = { 
							OR = {
								state_region = s:STATE_BADAJOZ
								state_region = s:STATE_BEIRA
								state_region = s:STATE_ESTREMADURA
								state_region = s:STATE_ALENTEJO
								state_region = s:STATE_MADEIRA
							}
							is_capital = no # covering bases in case somehow the capital is in madeira
						}
					}
					random_scope_state = { 
						limit = {
							OR = {
								state_region = s:STATE_BADAJOZ
								state_region = s:STATE_BEIRA
								state_region = s:STATE_ESTREMADURA
								state_region = s:STATE_ALENTEJO
								state_region = s:STATE_MADEIRA
							}
							is_capital = no
						} 
						save_temporary_scope_as = lusitania_state
					}
					create_country = {
						tag = LST
						origin = this
						state = scope:lusitania_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										OR = {
											state_region = s:STATE_BADAJOZ
											state_region = s:STATE_BEIRA
											state_region = s:STATE_ESTREMADURA
											state_region = s:STATE_ALENTEJO
											state_region = s:STATE_MADEIRA
										}
									}
									set_state_owner = c:LST
								}
							}
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:NAV }
						any_scope_state = { state_region = s:STATE_NAVARRA }
					}
					random_scope_state = { 
						limit = { state_region = s:STATE_NAVARRA } 
						save_temporary_scope_as = navarra_state
					}
					create_country = {
						tag = NAV
						origin = this
						state = scope:navarra_state
						on_created = {
						}
					}
				}
				if = {
					limit = { 
						OR = { 
							NOT = { exists = c:RE1 }
							NOT = { exists = c:RE2 }
							NOT = { exists = c:RE3 }
							NOT = { exists = c:RE4 }
						}
						any_scope_state = { 
							region = sr:region_iberia
							is_capital = no
						}
					}
					random_scope_state = { 
						limit = { 
							region = sr:region_iberia
							is_capital = no
						} 
						save_temporary_scope_as = hispania_state
					}
					if = {
						limit = { NOT = { exists = c:RE1 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:hispania_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											region = sr:region_iberia
											is_capital = no
										}
										set_state_owner = c:RE1
									}
								}
							}
						}
					}
					else_if = {
						limit = { NOT = { exists = c:RE2 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:hispania_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											region = sr:region_iberia
											is_capital = no
										}
										set_state_owner = c:RE2
									}
								}
							}
						}
					}
					else_if = {
						limit = { NOT = { exists = c:RE3 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:hispania_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											region = sr:region_iberia
											is_capital = no
										}
										set_state_owner = c:RE3
									}
								}
							}
						}
					}
					else_if = {
						limit = { NOT = { exists = c:RE4 } }
						create_country = {
							tag = RE1
							origin = this
							state = scope:hispania_state
							on_created = {
								ROOT = {
									every_scope_state = {
										limit = {
											region = sr:region_iberia
											is_capital = no
										}
										set_state_owner = c:RE4
									}
								}
							}
						}
					}
				}
			}

			# North Africa implodes if capital not in North Africa #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_north_africa }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:AFR }
						any_scope_state = { region = sr:region_north_africa }
					}
					random_scope_state = { 
						limit = { region = sr:region_north_africa } 
						save_temporary_scope_as = african_state
					}
					create_country = {
						tag = AFR
						origin = this
						state = scope:african_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_north_africa
										is_capital = no
									}
									set_state_owner = c:AFR
								}
							}
						}
					}
				}
			}

			# THE EASTERN EMPIRE #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_thracia }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:MSL }
						any_scope_state = { 
							region = sr:region_thracia 
							state_region = {
								OR = {
									is_homeland = cu:serb
									is_homeland = cu:sclaveni
								}
							}
						}
					}
					random_scope_state = { 
						limit = { 
							region = sr:region_thracia 
							state_region = {
								OR = {
									is_homeland = cu:serb
									is_homeland = cu:sclaveni
								}
							}
						} 
						save_temporary_scope_as = sklavinia_state
					}
					create_country = {
						tag = MSL
						origin = this
						state = scope:sklavinia_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_thracia
										OR = {
											is_homeland = cu:serb
											is_homeland = cu:sclaveni
										}
										is_capital = no
									}
									set_state_owner = c:AFR
								}
							}
						}
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:GRE }
						any_scope_state = { region = sr:region_thracia }
					}
					random_scope_state = { 
						limit = { region = sr:region_thracia } 
						save_temporary_scope_as = greek_state
					}
					create_country = {
						tag = GRE
						origin = this
						state = scope:greek_state
						on_created = {
							if = {
								limit = {
									NOT = { country_has_primary_culture = cu:greek }
								}
								add_primary_culture = greek
							}
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_thracia
										is_capital = no
									}
									set_state_owner = c:GRE
								}
							}
						}
					}
				}
			}

			# Cyprus is just doing its thing, man #
			if = {
				limit = { 
					NOT = { exists = c:CYP }
					any_scope_state = { state_region = s:STATE_CYPRUS }
				}
				random_scope_state = { 
					limit = { state_region = s:STATE_CYPRUS } 
					save_temporary_scope_as = cyprus_state
				}
				create_country = {
					tag = CYP
					origin = this
					state = scope:cyprus_state
					on_created = {
					}
				}
			}

			# Syria breaks free if capital not in the East #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_arabic }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:SYR }
						any_scope_state = { region = sr:region_arabic }
					}
					random_scope_state = { 
						limit = { region = sr:region_arabic } 
						save_temporary_scope_as = oriens_state
					}
					create_country = {
						tag = SYR
						origin = this
						state = scope:oriens_state
						on_created = {
							set_variable = syria_oriens
							add_primary_culture = cu:greek
							add_primary_culture = cu:assyrian
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_arabic
										is_capital = no
									}
									set_state_owner = c:SYR
								}
							}
						}
					}
				}
			}
			# Egypt breaks free if capital not in Egypt #
			if = {
				limit = {
					capital = {
						NOT = { region = sr:region_nile_basin }
					}
				}
				if = {
					limit = { 
						NOT = { exists = c:EGY }
						any_scope_state = { region = sr:region_nile_basin }
					}
					random_scope_state = { 
						limit = { region = sr:region_nile_basin } 
						save_temporary_scope_as = egyptian_state
					}
					create_country = {
						tag = EGY
						origin = this
						state = scope:egyptian_state
						on_created = {
							ROOT = {
								every_scope_state = {
									limit = {
										region = sr:region_nile_basin
										is_capital = no
									}
									set_state_owner = c:EGY
								}
							}
						}
					}
				}
			}
		}
	}
}

# Continuismo
roman_illegitimacy.4 = {
	type = country_event
	placement = ROOT
	
	title = roman_illegitimacy.4.t
	desc = roman_illegitimacy.4.d
	flavor = roman_illegitimacy.4.f
	
	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"
	
	duration = 3

	cooldown = { months = long_modifier_time }
	
	trigger = {
		# triggered by je_caudillo
		NOT = { has_global_variable = continuismo_start_var }
		ruler = {
			interest_group = {
				is_interest_group_type = ig_armed_forces
			}
			is_immortal = no
		}
		has_law = law_type:law_presidential_republic
		OR = {
			has_law = law_type:law_autocracy
			has_law = law_type:law_oligarchy
		}
		OR = {
			ig:ig_armed_forces = {
				leader = {
					is_ruler = no
				}
			}
			any_scope_character = {
				OR = {
					has_role = general
					has_role = admiral
				}
				interest_group = {
					is_interest_group_type = ig_armed_forces
				}
				is_ruler = no
			}
		}
	}

	immediate = {
		ig:ig_armed_forces = {
			save_scope_as = army_scope
		}
		ruler = {
			save_scope_as = ruler_scope
		}
		if = {
			limit = {
				ig:ig_armed_forces = {
					leader = {
						is_ruler = no
					}
				}
			}
			ig:ig_armed_forces = {
				leader = {
					save_scope_as = president_successor_scope
				}
			}
		}
		else_if = {
			limit = {
				any_scope_character = {
					OR = {
						has_role = general
						has_role = admiral
					}
					interest_group = {
						is_interest_group_type = ig_armed_forces
					}
					is_ruler = no
				}
			}
			random_scope_character = {
				limit = {
					OR = {
						has_role = general
						has_role = admiral
					}
					interest_group = {
						is_interest_group_type = ig_armed_forces
					}
					is_ruler = no
				}
				save_scope_as = president_successor_scope
			}
		}
	}
	option = {
		name = roman_illegitimacy.4.a
		default_option = yes
		custom_tooltip = {
			text = gain_large_caudillo_points
			change_variable = {
				name = caudillo_var
				add = 200
			}
		}
		ig:ig_armed_forces = {
			add_modifier = {
				name = continuismo
				months = normal_modifier_time
			}
		}
		ai_chance = {
			base = 15
		}
	}
	option = { # his term is over, time to step down
		name = roman_illegitimacy.4.b
		custom_tooltip = {
			text = retire_ruler
			ruler = {
				kill_character = { hidden = yes }
			}
		}
		ig:ig_armed_forces = {
			add_modifier = {
				name = no_continuismo
				months = normal_modifier_time
			}
		}
		custom_tooltip = {
			text = lose_large_caudillo_points
			change_variable = {
				name = caudillo_var
				add = -200
			}
		}
		ai_chance = {
			base = 3
		}
	}
	option = { # his successor takes over
		name = roman_illegitimacy.4.c
		scope:president_successor_scope = {
			set_character_as_ruler = yes
		}
		custom_tooltip = {
			text = gain_caudillo_points
			change_variable = {
				name = caudillo_var
				add = 100
			}
		}
		ai_chance = {
			base = 7
		}
	}
}

# Kingmaker
roman_illegitimacy.5 = {
	type = country_event
	placement = ROOT
	
	title = roman_illegitimacy.5.t
	desc = roman_illegitimacy.5.desc
	flavor = roman_illegitimacy.5.f
	
	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"
	
	duration = 3
	
	trigger = {
		# triggered by on_action
	}

	immediate = {
		ig:ig_armed_forces = {
			save_scope_as = army_scope
			leader = {
				save_scope_as = army_leader
				set_variable = caudillo_kingmaker
			}
		}
		py:conservative_party ?= {
			save_scope_as = conservative_party
		}
		py:liberal_party ?= {
			save_scope_as = liberal_party
		}
		if = {
			limit = {
				any_active_party = {
					is_party_type = communist_party
				}
			}
			py:communist_party = {
				save_scope_as = communist_party
			}
		}
		if = {
			limit = {
				any_active_party = {
					is_party_type = fascist_party
				}
			}
			py:fascist_party = {
				save_scope_as = fascist_party
			}
		}
	}
	option = { 
		name = roman_illegitimacy.5.a
		default_option = yes
		if = {
			limit = {
				has_journal_entry = je_caudillo
			}
			custom_tooltip = {
				text = gain_caudillo_points
				change_variable = {
					name = caudillo_var
					add = 100
				}
			}
		}
		custom_tooltip = {
			text = armed_forces_support_conservative
			ig:ig_armed_forces = {
				leader = {
					set_variable = caudillo_conservative
				}
			}
		}
		update_party_support = yes
	}
	option = { 
		name = roman_illegitimacy.5.b
		trigger = {
			exists = scope:liberal_party
		}
		if = {
			limit = {
				has_journal_entry = je_caudillo
			}
			custom_tooltip = {
				text = gain_caudillo_points
				change_variable = {
					name = caudillo_var
					add = 100
				}
			}
		}
		custom_tooltip = {
			text = armed_forces_support_liberal
			ig:ig_armed_forces = {
				leader = {
					set_variable = caudillo_liberal
				}
			}
		}
		update_party_support = yes
	}
	option = { 
		name = roman_illegitimacy.5.c
		trigger = {
			any_active_party = {
				is_party_type = communist_party
			}
			ig:ig_armed_forces = {
				leader = {
					OR = {
						has_ideology = ideology:ideology_vanguardist
						has_ideology = ideology:ideology_communist
						has_ideology = ideology:ideology_anarchist
					}
				}
			}
		}
		highlighted_option = yes
		if = {
			limit = {
				has_journal_entry = je_caudillo
			}
			custom_tooltip = {
				text = gain_caudillo_points
				change_variable = {
					name = caudillo_var
					add = 100
				}
			}
		}
		custom_tooltip = {
			text = armed_forces_support_communist
			ig:ig_armed_forces = {
				leader = {
					set_variable = caudillo_communist
				}
			}
		}
		update_party_support = yes
	}
	option = { 
		name = roman_illegitimacy.5.d
		trigger = {
			any_active_party = {
				is_party_type = fascist_party
			}
			ig:ig_armed_forces = {
				leader = {
					OR = {
						has_ideology = ideology:ideology_fascist
						has_ideology = ideology:ideology_ethno_nationalist
					}
				}
			}
		}
		highlighted_option = yes
		if = {
			limit = {
				has_journal_entry = je_caudillo
			}
			custom_tooltip = {
				text = gain_caudillo_points
				change_variable = {
					name = caudillo_var
					add = 100
				}
			}
		}
		custom_tooltip = {
			text = armed_forces_support_fascist
			ig:ig_armed_forces = {
				leader = {
					set_variable = caudillo_fascist
				}
			}
		}
		update_party_support = yes
	}

	cancellation_trigger = {
		NOT = {
			exists = scope:army_leader
		}
	}
}

roman_illegitimacy.6 = {
	type = country_event
	placement = ROOT
	
	title = roman_illegitimacy.6.t
	desc = roman_illegitimacy.6.d
	flavor = roman_illegitimacy.6.f
	
	gui_window = event_window_2char

	left_icon = scope:leadership_challenge_commander
	right_icon = scope:leadership_challenge_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/2Characters"

	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"

	cooldown = { months = normal_modifier_time }
	
	duration = 3
	
	trigger = {
		has_journal_entry = je_caudillo
		any_scope_character = {
			OR = {
				has_role = general
				has_role = admiral
			}
			popularity > interest_group.leader.popularity
			NOR = {
				has_trait = reserved
				has_trait = cautious
			}
			NOR = {
				has_role = politician
				is_ruler = yes
				is_heir = yes
			}
			this.interest_group = {
				leader = {
					NOR = {
						has_role = general
						has_role = admiral
					}
				}
			}
		}
	}

	immediate = {
		random_scope_character = {
			limit = {
				OR = {
					has_role = general
					has_role = admiral
				}
				popularity > interest_group.leader.popularity
				NOR = {
					has_trait = reserved
					has_trait = cautious
				}
				NOR = {
					has_role = politician
					is_ruler = yes
					is_heir = yes
				}
				this.interest_group = {
					leader = {
						NOR = {
							has_role = general
							has_role = admiral
						}
					}
				}
			}
			save_scope_as = leadership_challenge_commander
			this.interest_group = {
				save_scope_as = leadership_challenge_ig
				leader = {
					save_scope_as = leadership_challenge_politician
				}
			}
		}
	}
	option = { 
		name = roman_illegitimacy.6.a
		default_option = yes
		if = {
			limit = {
				empty_agitator_slots >= 1
				NOT = {
					scope:leadership_challenge_politician = {
						has_ideology = ideology:ideology_moderate
					}
				}
			}
			scope:leadership_challenge_politician = {
				remove_character_role = politician
				add_character_role = agitator
			}
		}
		else = {
			custom_tooltip = politician_gets_pushed_out_tt
		}
		scope:leadership_challenge_commander = {
			add_character_role = politician
			set_as_interest_group_leader = yes
		}
		custom_tooltip = {
			text = gain_caudillo_points
			change_variable = {
				name = caudillo_var
				add = 100
			}
		}
	}
	option = { 
		name = roman_illegitimacy.6.b
		custom_tooltip = {
			text = lose_caudillo_points
			change_variable = {
				name = caudillo_var
				add = -100
			}
		}
	}
}
